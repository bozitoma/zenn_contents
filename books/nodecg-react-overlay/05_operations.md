---
title: "第5章：NodeCGの運用 〜覚えておきたい5つのポイント〜"
---

ここまで、NodeCGを使ってアプリを開発してきました。
本章では、作成したNodeCGアプリを実際に本番で運用する際のポイントを紹介します。

今回紹介するポイントを押さえておけば、大半の配信で運用ができるようになるはずです。
ぜひ参考にしてください。

-----

:::message
**本書で紹介するテンプレートのリポジトリ**
[nodecg-template-with-vite](https://github.com/bozitoma/nodecg-template-with-vite)
:::
https://github.com/bozitoma/nodecg-template-with-vite/blob/main/README.md#L1-L23

-----

## 1. 基本は「配信PCでローカル起動」がおすすめ
AWSやHeroku等にデプロイして運用することも可能ですが、基本は**配信を行うPCで、ローカル環境として起動するのがおすすめ**です。

*   **理由1：遅延（ラグ）の回避**
    *   クラウドを経由すると、インターネット環境によっては操作から画面反映までにラグが発生します。ローカル起動なら遅延はほぼゼロです。
*   **理由2：安定性**
    *   インターネット回線が不安定になっても、ローカルで動いているNodeCGは影響を受けません。
*   **理由3：シンプルさ**
    *   配信PC1台で完結するため、追加の機材や複雑な設定が不要です。

**基本構成の手順:**
1.  配信PCでNodeCG（`npx nodecg start`）を起動する。
2.  OBS StudioのブラウザソースにGraphicsのURL(例: `http://localhost:9090/...`) を設定する。
3.  同じPCのブラウザでDashboardを開き、操作する。

もっともシンプルなこの構成で、まずは始めてみるのが良いでしょう。

## 2. 本番では「開発モードを使わない」
本番運用時には **開発モード（pnpm dev）を使わない** ようにしましょう。

開発中は `pnpm dev` を使っていましたが、これは開発専用のサーバー（Vite）も同時に動かしています。このサーバーは、外部デバイス（スマホや別のPC）からアクセスすると、通信の仕組みの違いにより画面が正しく表示されないなどのトラブルが起きやすいです。

本番では必ず以下の手順で**ビルド**してから、Viteは起動せずにNodeCGだけ起動するようにします。

```bash
# プロジェクトのルートディレクトリで実行

# 1. 本番用にファイルをビルドする
pnpm build

# 2. NodeCGを起動する
npx nodecg start
```

## 3. 複数人で運用するなら「ネットワークを活用する」
「スコアボードはAさん、コメント表示はBさん」のように、複数人で操作を分担したい場合、ネットワークを活用することで他のPCやスマホからNodeCGを操作できます。
ここでは、2つの接続方法を紹介します。

### 3-1. ローカルネットワークで接続する
同じWi-Fiやルーターに接続している端末から、NodeCGを起動しているPCにアクセスすることで、複数人でNodeCGを運用することができます。

ローカルネットワークが構築できれば、PCだけでなくタブレットやスマホからもNodeCGを操作できるようになります。
**小型のルーター**や**スイッチングハブ**を持参すれば、会場のネットワーク状況に左右されずに、安定したローカルネットワークを構築できるのでおすすめです。

:::details ローカルネットワークの接続手順
1.  NodeCGをビルド（`pnpm build`）する。
2.  NodeCGを起動（`npx nodecg start`）する。
3.  NodeCGを起動しているPCの「ローカルIPアドレス」を調べる（例: `192.168.1.15`）。
    *   **Windowsの場合:**
        *   **コマンド:** ターミナルで `ipconfig` を実行し、「IPv4 アドレス」を確認。
        *   **GUI:** 「設定」→「ネットワークとインターネット」→「イーサネット」から「IPv4 アドレス」を確認。
    *   **Macの場合:**
        *   **コマンド:** ターミナルで `ipconfig getifaddr en0` を実行し、結果を確認。
        *   **GUI:** 「システム設定」→「Wi-Fi」→接続中のWi-Fiの「詳細」ボタンから確認。
4.  他のPCやスマホのブラウザから、`http://[NodeCGを起動しているPCのIP]:9090` にアクセスする。
:::

### 3-2. トンネリングサービスを利用する (ngrokなど)
ローカルネットワーク外からNodeCGにアクセスしたい場合は、**トンネリングサービス**を使うのが便利です。
手元のPCで動いているローカルサーバーを一時的にインターネット上に安全に公開できます。

代表的なツールとして **ngrok（エングロック）** があります。
`https://xxxx.ngrok-free.app` のような一時的なURLが発行され、外部のスタッフがそのURLからNodeCGにアクセスできるようになります。
@[card](https://ngrok.com/)

:::details ngrokの導入手順
ngrokを利用するには、アカウント登録（認証トークンの設定）とNodeCGを起動するPCでインストールが必要です。

1.  **アカウント作成**: [ngrok公式サイト](https://ngrok.com/)にアクセスし、アカウントを作成（Sign up）します。
2.  **インストール**: ダッシュボードの案内（Getting Started）に従ってインストールします。
3.  **認証トークンの設定**: ダッシュボードに表示されている `ngrok config add-authtoken <TOKEN>` というコマンドをコピーし、ターミナルで実行します。これが初回のみ必要です。
4.  **起動**: 以下のコマンドでポート9090（NodeCGのポート）を公開します。
    ```bash
    ngrok http 9090
    ```
5.  **共有**: ターミナルに表示されたURL（`Forwarding` の部分。例: `https://xxxx.ngrok-free.app`）をスタッフに共有します。
:::

## 4. 「ログイン機能」を活用してセキュリティを高める
ngrokなどを使うと、URLを知っていれば誰でも操作できてしまいます。
これを防ぐための手段として、NodeCG標準のログイン機能（認証機能）を紹介します。

### 4-1. NodeCGのログイン機能
NodeCGには、Dashboardへのアクセスを制限するための **ログイン機能** が標準で備わっています。
これを有効にすると、許可されたユーザー以外は操作画面にアクセスできなくなります。

ログイン方法はいくつか用意されており、TwitchやSteam、Discordなどの外部アカウントを使った認証も可能です。

https://www.nodecg.dev/docs/nodecg-configuration

### 4-2. ローカルログインの設定方法
ここでは、NodeCGの設定ファイルだけで完結する「ローカルログイン」の設定を紹介します。
`cfg/nodecg.json` を作成して、ログイン設定を追加するだけでOKです。
（※`nodecg.json` 以外にも `nodecg.js` や `nodecg.yaml` 形式でも設定可能です）

```json:cfg/nodecg.json
{
  "login": {
    "enabled": true,
    "sessionSecret": "random-secret-string-here",
    "local": {
      "enabled": true,
      "allowedUsers": [
        { "username": "admin", "password": "password" }
      ]
    }
  }
}
```

*   `sessionSecret`: セッション暗号化用のランダムな文字列（適当な文字列でOK）
*   `allowedUsers`: 許可するユーザー名とパスワードのリスト

これを設定してNodeCGを起動すると、Dashboardへのアクセス時にログイン画面が表示されるようになります。

![](/images/nodecg-react-overlay/05-nodecg-login.png)
*NodeCGのログイン画面*

スタッフに操作してもらう場合は、設定した **ユーザー名 (`admin`) とパスワード (`password`) を共有** してください。
`allowedUsers` のリストに別のユーザーを追加すれば、スタッフごとに個別のアカウントを発行することも可能です。

## 5. NodeCG用のPCを用意して「負荷を分散する」
頻繁な更新や重たい集計作業などの処理をNodeCGに行わせる場合、配信PCで行うと配信の動作（フレームレートなど）に影響が出る可能性があります。
その場合は、配信PCとは別のPCでNodeCGを起動する構成を検討してください。

PCを分けた場合でも、ローカルネットワークを活用することで、映像を配信PCに取り込むことができます。

:::details 映像をNodeCG PCから配信PCに取り込む手順
1.  **ネットワーク接続**: NodeCG PCと配信PCを同じルーター（LAN）に接続します。
2.  **IPアドレスの確認**: NodeCG PCのIPアドレスを確認します（例: `192.168.1.15`）。
    *   **Windowsの場合:**
        *   **コマンド:** ターミナルで `ipconfig` を実行し、「IPv4 アドレス」を確認。
        *   **GUI:** 「設定」→「ネットワークとインターネット」→「イーサネット」から「IPv4 アドレス」を確認。
    *   **Macの場合:**
        *   **コマンド:** ターミナルで `ipconfig getifaddr en0` を実行し、結果を確認。
        *   **GUI:** 「システム設定」→「Wi-Fi」→接続中のWi-Fiの「詳細」ボタンから確認。
3.  **OBS Studioでの設定**: 配信PCのOBS Studioを開き、「ブラウザ」ソースを追加します。
4.  **URLの入力**: URL欄に以下のように、localhostの部分をNodeCG PCのIPアドレスに変更したURLを入力します。
    *   例: `http://192.168.1.15:9090/bundles/nodecg-template-with-vite/graphics/scoreboard/index.html`
:::

---

## 6. おわりに
まずは、**配信PCでNodeCGをローカル起動する** という、最も手軽な運用方法から始めてみるのがおすすめです。

もし「複数人のスタッフで分担したい」ならローカルネットワークやngrokを活用し、「PCの負荷を減らしたい」ならNodeCG用のPCを用意するなど、運用を工夫することで幅広い配信要件に対応できるようになります。

本記事を参考に、ぜひご自身の配信環境に合わせた、最適なNodeCG運用を目指してみてください。

## 7. 全体のまとめ
本記事では全5章にわたり、NodeCGの基礎知識から、テンプレートを活用した開発、そして本番での運用のポイントまでを紹介してきました。

NodeCGを使えば、配信の要件に合わせた自由なデザインで**画面を彩る**ことはもちろん、運用スタッフが**楽に操作できる**専用の管理画面まで作り込むことができます。

また、今回は紹介しきれませんでしたが、データベースと接続して大量のデータを扱ったり、[Supabase](https://supabase.com/)などのSaaSと連携して外部データを取得したり、[Rive](https://rive.app/)のようなツールでリッチなアニメーションを実装したりすることも可能です。
フロントエンドとバックエンドの両方を内包しているNodeCGなら、アイデア次第で様々な要件を実現できます。

この本が、NodeCGを使った開発の第一歩として手助けになれば幸いです。
最後までお読みいただき、ありがとうございました！

:::message
**本書で紹介したテンプレートのリポジトリ**
[nodecg-template-with-vite](https://github.com/bozitoma/nodecg-template-with-vite)
:::
https://github.com/bozitoma/nodecg-template-with-vite/blob/main/README.md#L1-L23
